// Copyright Â© 2020 ONIXLabs
// 
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
// 
//    http://www.apache.org/licenses/LICENSE-2.0
// 
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

using System;
using System.Collections.Generic;
using System.Reflection;
using OnixLabs.Core.Numerics;
using Xunit;
using Xunit.Sdk;

namespace OnixLabs.Core.UnitTests.Numerics;

public sealed class BigDecimalArithmeticRoundTests
{
    [RoundData]
    [Theory(DisplayName = "BigDecimal.Round should produce the correct result")]
    public void BigDecimalRoundShouldProduceExpectedResult(decimal value, byte scale, MidpointRounding mode)
    {
        // Given
        decimal expected = decimal.Round(value, scale, mode);

        // When
        BigDecimal actual = BigDecimal.Round(value, scale, mode);

        // Then
        Assert.Equal(expected, actual);
    }

    private sealed class RoundDataAttribute : DataAttribute
    {
        private static readonly decimal[] Data =
        [
            decimal.Zero, decimal.One, decimal.MinusOne, decimal.MaxValue, decimal.MinValue,
            7922816251426433759354395033.5m,
            792281625142643375935439503.35m,
            79228162514264337593543950.335m,
            7922816251426433759354395.0335m,
            792281625142643375935439.50335m,
            79228162514264337593543.950335m,
            7922816251426433759354.3950335m,
            792281625142643375935.43950335m,
            79228162514264337593.543950335m,
            7922816251426433759.3543950335m,
            792281625142643375.93543950335m,
            79228162514264337.593543950335m,
            7922816251426433.7593543950335m,
            792281625142643.37593543950335m,
            79228162514264.337593543950335m,
            7922816251426.4337593543950335m,
            792281625142.64337593543950335m,
            79228162514.264337593543950335m,
            7922816251.4264337593543950335m,
            792281625.14264337593543950335m,
            79228162.514264337593543950335m,
            7922816.2514264337593543950335m,
            792281.62514264337593543950335m,
            79228.162514264337593543950335m,
            7922.8162514264337593543950335m,
            792.28162514264337593543950335m,
            79.228162514264337593543950335m,
            7.9228162514264337593543950335m,
            -7922816251426433759354395033.5m,
            -792281625142643375935439503.35m,
            -79228162514264337593543950.335m,
            -7922816251426433759354395.0335m,
            -792281625142643375935439.50335m,
            -79228162514264337593543.950335m,
            -7922816251426433759354.3950335m,
            -792281625142643375935.43950335m,
            -79228162514264337593.543950335m,
            -7922816251426433759.3543950335m,
            -792281625142643375.93543950335m,
            -79228162514264337.593543950335m,
            -7922816251426433.7593543950335m,
            -792281625142643.37593543950335m,
            -79228162514264.337593543950335m,
            -7922816251426.4337593543950335m,
            -792281625142.64337593543950335m,
            -79228162514.264337593543950335m,
            -7922816251.4264337593543950335m,
            -792281625.14264337593543950335m,
            -79228162.514264337593543950335m,
            -7922816.2514264337593543950335m,
            -792281.62514264337593543950335m,
            -79228.162514264337593543950335m,
            -7922.8162514264337593543950335m,
            -792.28162514264337593543950335m,
            -79.228162514264337593543950335m,
            -7.9228162514264337593543950335m,
            1699121604399010340336671.3824m,
            274409038653102834743434899.75m,
            6124946691126313869534.491756m,
            -325862.34374673540806613992608m,
            210.29053664107489135552591067m,
            26911439311.144997733176091132m,
            -10127582182.550910070741781031m,
            1803151995177993810.1185381820m,
            4125373736199796.601106439140m,
            222340536596268951203683854.56m,
            -31018524386423404077409445600m,
            3685.2338927279455130781384735m,
            -345835981504.01659417259789872m,
            196563955602198661184052.62849m,
            4152332468075378080865402655m,
            16297707559227567505.125761077m,
            230948970231954696.66459746748m,
            -2796503862040464.9198199054751m,
            -2855490768217718741127.9153426m,
            3006556281414794394526439.7534m,
            21220475029900702561.035908869m,
            -160955319659974.36959317359210m,
            -3797735966001899695515836645.4m,
            -3336668284398357711089.8326720m,
            -345.58220449646371591674072359m,
            -11164095620657726520654441001m,
            -20138816426750347773472657.005m,
            -2991541617037249357820754.6586m,
            -62061934682659648042505414.78m,
            27089380740194781824628832.952m,
            -26750932078.1825392652161029m,
            30928491.673630676992966170639m,
            967.8294782410186559300040651m,
            -173162413629122662491586710.12m,
            -193178008105224.39639269994735m,
            1110623366.3734198596014690841m,
            -17946511891889536.131237405483m,
            -19495878724.728525164029934158m,
            2433763839.661889686657239565m,
            -16913031618820474274129.611399m,
            -216025532648311221.06116523411m,
            -27923662719334012559860.393080m,
            253653315093.87578725737676764m,
            -288963740929055682.38182059063m,
            175.46009782972772195719199333m,
            -826.5464980228938605866844013m,
            -33362963793285733444.186902531m,
            -303857702791179.17239693608356m,
            283048.22038519785772565636766m,
            -1286401420682193691928.8863557m,
            26450850141.299076342815338237m,
            -104831048038940.88912622313648m,
            222.97154293687011384209013408m,
            -12021505301232008610423550.065m,
            222286716737854031527.39373081m,
            31920113516645330359829500064m,
            -1315703644528000592.749178402m,
            -375378.33756073502791623502417m,
            819475496880641816.1034367109m,
            -273033025213764595.35499972436m,
            -203860733459558939.9431480990m,
            2242463213947839760105680.6390m,
            141106370835903.90559946362912m,
            -2250307273327878044730850.8675m,
            12924.130408580864508470334700m,
            -2330007912626.9955520759443689m,
            225.14291618289169899090788286m,
            1689005953993627.3244375494676m,
            -34381185678517867.596691039605m,
            -5191576837.426245858515623524m,
            20095124136240566476506235.480m,
            -36531144662941379.172585001361m,
            -182982.62860810300888452254857m,
            5571236286044924.556222392070m,
            2870081491394887468041880.9548m,
            23060.082761832665859236627049m,
            375947309799680995399.18054438m,
            -37137933484815397928298681.495m,
            -709.4837803796527867267705437m,
            124465688982061036.3736842729m,
            -121033597210192420635.48311017m,
            -379797558327246003102.86323037m,
            392426019842.17091477430064966m,
            135368569410354173891754.12383m,
            -12.278024948480811794949196481m,
            -3461413101643771.8653767810720m,
            -292.05794539264216208913280219m,
            94572378720107070.80991818816m,
            13579155363421.350011716452324m,
            -265209907699065177829.07585094m,
            114576003980735931653.83391056m,
            314470216966.1984201959100297m,
            1786533764546651.6930694849077m,
            -42407.81789758464632310595082m,
            -12027048730649171.963686540138m,
            3691412.6826836558800171602638m,
            3911026058025088.7210080042140m,
            100259076741234022.60666523736m,
            6490959734920872932.464358490m,
            3905096010850072817.7851286045m,
            -8.305916677625652343425686293m,
            2046682442242.9758188524889923m,
            -233384688790438073793.49150127m,
            -1562569903860061679865749.000m,
            -240872108438315510499837420.57m,
            -307953770.54880455632884239394m,
            284460548.44747855667172085288m,
            7245125570871778132372.35490m,
            -38476280810650520334296823.586m,
            -3671130673928736946350808.7054m,
            -39041079591.190332545671612883m,
            -22156.11484208204129983513618m,
            302472407801846050294110.76077m,
            -34232352215020534.675972092962m,
            -876484320809782519.5675473737m,
            -265596666.69264063396859689313m,
            -211655961263567611.49084431494m,
            51226325950130296053080.70291m,
            -292291672839629521713805.37860m,
            34893190282208935814811.521939m,
            -310049872565089254970926.42463m,
            393348.11446157494870468721030m,
            1264948559881.7765348586439724m,
            29256730111724011014087494.526m,
            -21480438441551312026.358328890m,
            597155047754787399145215161.9m,
            -13427986265383360349839950.970m,
            -2972596321978310.4437014172333m,
            -17989.391257016003816689560699m,
            6.014677714653993203343847897m,
            42162178811627644763.98580702m,
            -47816892996558474288540558.55m,
            -3190927074944.817022264581208m,
            124834936.40413864910993872851m,
            22567011993449640.898051555569m,
            -37452633406507587960588258.549m,
            -155.49002582666789196912407310m,
            380511446180705.39731883036563m,
            67.16711064231821805545631809m,
            286527389793776585095.54399714m,
            1413141819141213985.5585372934m,
            -52538.72135663751620063606623m,
            -45732380.7104723806089630350m,
            -30729945940174.491460604994115m,
            170499093787638.51972542399296m,
            -8278582343037227401957345550m,
            -98423979570.76454363943962254m,
            -36375731100418582520.584829115m,
            -3955.0608317446585561781931788m,
            -310129845.71351860242070491463m,
            -37945028345766362059792380.220m,
            273494138770552383.60100429457m,
            337.2918645535485276369353998m,
            -10276200205.789138130573142250m,
            -1511404730839.7437744082433996m,
            -232736989148038403804.24839129m,
            321.19763570697183496415267814m,
            -38793.231145255987942068477753m,
            459414992238.0193007644768997m,
            1681272474083.3331543620618565m,
            39201532.0736354736891458128m,
            -39103495.01904672189470935236m,
            36917739.849424355860104378491m,
            -378.56777974925372133959016334m,
            11287664826388596.093134201805m,
            -132748750091.51542419586352711m,
            31044396043661662876924.24775m,
            -3123.932946436533849012927552m,
            3948237693615.0680783725265843m,
            -32177504777981354722970.881664m,
            2663817944089146353198.3073528m,
            210135279590471.31350619017882m,
            -40.45292268482291903381446850m,
            261046996614129923796.2730225m,
            -7348367057169999944461.071337m,
            27.184657522520686802671511506m,
            38992863.769163617726533765796m,
            -154739922789459065797345.23513m,
            272498.89844672640031293054138m,
            338728.94724994600498038096838m,
            16284900358921.733515248901918m,
            1348303089248112.9259307704801m,
            12058.365883097833364415013492m,
            7184.437699538930259520969336m,
            394220449973816434371124.03562m,
            -3248.0597471971020745107477334m,
            361720735534094.02829878145576m,
            360047089548.56589770820373013m,
            -121498935115984746852.85088466m,
            -255500113633988856072831784.17m,
            304477465789.86542662564981586m,
            -286954246337.72093720942584413m,
            -254683059785718732649239.0028m,
            72951.51462538223590614799791m,
            -204571186277542744046.6684784m,
            -381.1249681561282242393037909m,
            -38397163094701654362628726.681m,
            -23194.520032751350365302443647m,
            391552700218800371195.86317750m,
            -142.51973972793308518911478988m,
        ];

        public override IEnumerable<object[]> GetData(MethodInfo testMethod)
        {
            foreach (decimal value in Data)
            {
                for (int scale = 0; scale <= 28; scale++)
                {
                    foreach (MidpointRounding mode in Enum.GetValues<MidpointRounding>())
                    {
                        yield return [value, scale, mode];
                    }
                }
            }
        }
    }
}
